var $target = $('.discussionDisplay');
var discussionId = '<%= @discussion.id %>';
if ( $target.is(':visible') ) {
	$target.slideToggle(function() {
		appendDiscussion($target);		
	});	
} else {
	appendDiscussion($target);
}
window.history.pushState({}, 'discussion', '/discussions/' + discussionId);

var appendDiscussion = function(target) {
	target.replaceWith('<%= j render "show" %>');
	target.slideToggle(addListeners);	
}

var addListeners = function() {
	myApp.addDiscussionListeners();
	myApp.addPostListeners();
}